{"version":3,"file":"create-render-step.js","sources":["../../../../../../node_modules/framesync/dist/es/create-render-step.js"],"sourcesContent":["function createRenderStep(runNextFrame) {\n    var toRun = [];\n    var toRunNextFrame = [];\n    var numToRun = 0;\n    var isProcessing = false;\n    var toKeepAlive = new WeakSet();\n    var step = {\n        schedule: function (callback, keepAlive, immediate) {\n            if (keepAlive === void 0) { keepAlive = false; }\n            if (immediate === void 0) { immediate = false; }\n            var addToCurrentFrame = immediate && isProcessing;\n            var buffer = addToCurrentFrame ? toRun : toRunNextFrame;\n            if (keepAlive)\n                toKeepAlive.add(callback);\n            if (buffer.indexOf(callback) === -1) {\n                buffer.push(callback);\n                if (addToCurrentFrame && isProcessing)\n                    numToRun = toRun.length;\n            }\n            return callback;\n        },\n        cancel: function (callback) {\n            var index = toRunNextFrame.indexOf(callback);\n            if (index !== -1)\n                toRunNextFrame.splice(index, 1);\n            toKeepAlive.delete(callback);\n        },\n        process: function (frameData) {\n            var _a;\n            isProcessing = true;\n            _a = [toRunNextFrame, toRun], toRun = _a[0], toRunNextFrame = _a[1];\n            toRunNextFrame.length = 0;\n            numToRun = toRun.length;\n            if (numToRun) {\n                for (var i = 0; i < numToRun; i++) {\n                    var callback = toRun[i];\n                    callback(frameData);\n                    if (toKeepAlive.has(callback)) {\n                        step.schedule(callback);\n                        runNextFrame();\n                    }\n                }\n            }\n            isProcessing = false;\n        },\n    };\n    return step;\n}\n\nexport { createRenderStep };\n"],"names":["createRenderStep","runNextFrame","toRun","toRunNextFrame","numToRun","isProcessing","toKeepAlive","WeakSet","step","schedule","callback","keepAlive","immediate","addToCurrentFrame","buffer","add","indexOf","push","length","cancel","index","splice","delete","process","frameData","_a","i","has"],"mappings":"AAAA,SAASA,EAAiBC,GACtB,IAAIC,EAAQ,GACRC,EAAiB,GACjBC,EAAW,EACXC,GAAe,EACfC,EAAc,IAAIC,QAClBC,EAAO,CACPC,SAAU,SAAUC,EAAUC,EAAWC,QACnB,IAAdD,IAAwBA,GAAY,QACtB,IAAdC,IAAwBA,GAAY,GACxC,IAAIC,EAAoBD,GAAaP,EACjCS,EAASD,EAAoBX,EAAQC,EAQzC,OAPIQ,GACAL,EAAYS,IAAIL,IACc,IAA9BI,EAAOE,QAAQN,KACfI,EAAOG,KAAKP,GACRG,GAAqBR,IACrBD,EAAWF,EAAMgB,SAElBR,CACV,EACDS,OAAQ,SAAUT,GACd,IAAIU,EAAQjB,EAAea,QAAQN,IACpB,IAAXU,GACAjB,EAAekB,OAAOD,EAAO,GACjCd,EAAYgB,OAAOZ,EACtB,EACDa,QAAS,SAAUC,GACf,IAAIC,EAKJ,GAJApB,GAAe,EACeH,GAA9BuB,EAAK,CAACtB,EAAgBD,IAAmB,IAAIC,EAAiBsB,EAAG,IAClDP,OAAS,EACxBd,EAAWF,EAAMgB,OAEb,IAAK,IAAIQ,EAAI,EAAGA,EAAItB,EAAUsB,IAAK,CAC/B,IAAIhB,EAAWR,EAAMwB,GACrBhB,EAASc,GACLlB,EAAYqB,IAAIjB,KAChBF,EAAKC,SAASC,GACdT,IAEP,CAELI,GAAe,CAClB,GAEL,OAAOG,CACX"}