{"version":3,"file":"transitions.mjs.js","sources":["../../../../../../../../node_modules/framer-motion/dist/es/animation/utils/transitions.mjs"],"sourcesContent":["import { __assign, __rest, __spreadArray, __read } from 'tslib';\nimport { inertia, animate } from 'popmotion';\nimport { secondsToMilliseconds } from '../../utils/time-conversion.mjs';\nimport { isEasingArray, easingDefinitionToFunction } from './easing.mjs';\nimport { isAnimatable } from './is-animatable.mjs';\nimport { getDefaultTransition } from './default-transitions.mjs';\nimport { warning } from 'hey-listen';\nimport { getAnimatableNone } from '../../render/dom/value-types/animatable-none.mjs';\nimport { instantAnimationState } from '../../utils/use-instant-transition-state.mjs';\nimport { resolveFinalValueInKeyframes } from '../../utils/resolve-value.mjs';\n\n/**\n * Decide whether a transition is defined on a given Transition.\n * This filters out orchestration options and returns true\n * if any options are left.\n */\nfunction isTransitionDefined(_a) {\n    _a.when; _a.delay; _a.delayChildren; _a.staggerChildren; _a.staggerDirection; _a.repeat; _a.repeatType; _a.repeatDelay; _a.from; var transition = __rest(_a, [\"when\", \"delay\", \"delayChildren\", \"staggerChildren\", \"staggerDirection\", \"repeat\", \"repeatType\", \"repeatDelay\", \"from\"]);\n    return !!Object.keys(transition).length;\n}\nvar legacyRepeatWarning = false;\n/**\n * Convert Framer Motion's Transition type into Popmotion-compatible options.\n */\nfunction convertTransitionToAnimationOptions(_a) {\n    var ease = _a.ease, times = _a.times, yoyo = _a.yoyo, flip = _a.flip, loop = _a.loop, transition = __rest(_a, [\"ease\", \"times\", \"yoyo\", \"flip\", \"loop\"]);\n    var options = __assign({}, transition);\n    if (times)\n        options[\"offset\"] = times;\n    /**\n     * Convert any existing durations from seconds to milliseconds\n     */\n    if (transition.duration)\n        options[\"duration\"] = secondsToMilliseconds(transition.duration);\n    if (transition.repeatDelay)\n        options.repeatDelay = secondsToMilliseconds(transition.repeatDelay);\n    /**\n     * Map easing names to Popmotion's easing functions\n     */\n    if (ease) {\n        options[\"ease\"] = isEasingArray(ease)\n            ? ease.map(easingDefinitionToFunction)\n            : easingDefinitionToFunction(ease);\n    }\n    /**\n     * Support legacy transition API\n     */\n    if (transition.type === \"tween\")\n        options.type = \"keyframes\";\n    /**\n     * TODO: These options are officially removed from the API.\n     */\n    if (yoyo || loop || flip) {\n        warning(!legacyRepeatWarning, \"yoyo, loop and flip have been removed from the API. Replace with repeat and repeatType options.\");\n        legacyRepeatWarning = true;\n        if (yoyo) {\n            options.repeatType = \"reverse\";\n        }\n        else if (loop) {\n            options.repeatType = \"loop\";\n        }\n        else if (flip) {\n            options.repeatType = \"mirror\";\n        }\n        options.repeat = loop || yoyo || flip || transition.repeat;\n    }\n    /**\n     * TODO: Popmotion 9 has the ability to automatically detect whether to use\n     * a keyframes or spring animation, but does so by detecting velocity and other spring options.\n     * It'd be good to introduce a similar thing here.\n     */\n    if (transition.type !== \"spring\")\n        options.type = \"keyframes\";\n    return options;\n}\n/**\n * Get the delay for a value by checking Transition with decreasing specificity.\n */\nfunction getDelayFromTransition(transition, key) {\n    var _a, _b;\n    var valueTransition = getValueTransition(transition, key) || {};\n    return (_b = (_a = valueTransition.delay) !== null && _a !== void 0 ? _a : transition.delay) !== null && _b !== void 0 ? _b : 0;\n}\nfunction hydrateKeyframes(options) {\n    if (Array.isArray(options.to) && options.to[0] === null) {\n        options.to = __spreadArray([], __read(options.to), false);\n        options.to[0] = options.from;\n    }\n    return options;\n}\nfunction getPopmotionAnimationOptions(transition, options, key) {\n    var _a;\n    if (Array.isArray(options.to)) {\n        (_a = transition.duration) !== null && _a !== void 0 ? _a : (transition.duration = 0.8);\n    }\n    hydrateKeyframes(options);\n    /**\n     * Get a default transition if none is determined to be defined.\n     */\n    if (!isTransitionDefined(transition)) {\n        transition = __assign(__assign({}, transition), getDefaultTransition(key, options.to));\n    }\n    return __assign(__assign({}, options), convertTransitionToAnimationOptions(transition));\n}\n/**\n *\n */\nfunction getAnimation(key, value, target, transition, onComplete) {\n    var _a;\n    var valueTransition = getValueTransition(transition, key);\n    var origin = (_a = valueTransition.from) !== null && _a !== void 0 ? _a : value.get();\n    var isTargetAnimatable = isAnimatable(key, target);\n    if (origin === \"none\" && isTargetAnimatable && typeof target === \"string\") {\n        /**\n         * If we're trying to animate from \"none\", try and get an animatable version\n         * of the target. This could be improved to work both ways.\n         */\n        origin = getAnimatableNone(key, target);\n    }\n    else if (isZero(origin) && typeof target === \"string\") {\n        origin = getZeroUnit(target);\n    }\n    else if (!Array.isArray(target) &&\n        isZero(target) &&\n        typeof origin === \"string\") {\n        target = getZeroUnit(origin);\n    }\n    var isOriginAnimatable = isAnimatable(key, origin);\n    warning(isOriginAnimatable === isTargetAnimatable, \"You are trying to animate \".concat(key, \" from \\\"\").concat(origin, \"\\\" to \\\"\").concat(target, \"\\\". \").concat(origin, \" is not an animatable value - to enable this animation set \").concat(origin, \" to a value animatable to \").concat(target, \" via the `style` property.\"));\n    function start() {\n        var options = {\n            from: origin,\n            to: target,\n            velocity: value.getVelocity(),\n            onComplete: onComplete,\n            onUpdate: function (v) { return value.set(v); },\n        };\n        return valueTransition.type === \"inertia\" ||\n            valueTransition.type === \"decay\"\n            ? inertia(__assign(__assign({}, options), valueTransition))\n            : animate(__assign(__assign({}, getPopmotionAnimationOptions(valueTransition, options, key)), { onUpdate: function (v) {\n                    var _a;\n                    options.onUpdate(v);\n                    (_a = valueTransition.onUpdate) === null || _a === void 0 ? void 0 : _a.call(valueTransition, v);\n                }, onComplete: function () {\n                    var _a;\n                    options.onComplete();\n                    (_a = valueTransition.onComplete) === null || _a === void 0 ? void 0 : _a.call(valueTransition);\n                } }));\n    }\n    function set() {\n        var _a, _b;\n        var finalTarget = resolveFinalValueInKeyframes(target);\n        value.set(finalTarget);\n        onComplete();\n        (_a = valueTransition === null || valueTransition === void 0 ? void 0 : valueTransition.onUpdate) === null || _a === void 0 ? void 0 : _a.call(valueTransition, finalTarget);\n        (_b = valueTransition === null || valueTransition === void 0 ? void 0 : valueTransition.onComplete) === null || _b === void 0 ? void 0 : _b.call(valueTransition);\n        return { stop: function () { } };\n    }\n    return !isOriginAnimatable ||\n        !isTargetAnimatable ||\n        valueTransition.type === false\n        ? set\n        : start;\n}\nfunction isZero(value) {\n    return (value === 0 ||\n        (typeof value === \"string\" &&\n            parseFloat(value) === 0 &&\n            value.indexOf(\" \") === -1));\n}\nfunction getZeroUnit(potentialUnitType) {\n    return typeof potentialUnitType === \"number\"\n        ? 0\n        : getAnimatableNone(\"\", potentialUnitType);\n}\nfunction getValueTransition(transition, key) {\n    return transition[key] || transition[\"default\"] || transition;\n}\n/**\n * Start animation on a MotionValue. This function is an interface between\n * Framer Motion and Popmotion\n */\nfunction startAnimation(key, value, target, transition) {\n    if (transition === void 0) { transition = {}; }\n    if (instantAnimationState.current) {\n        transition = { type: false };\n    }\n    return value.start(function (onComplete) {\n        var delayTimer;\n        var controls;\n        var animation = getAnimation(key, value, target, transition, onComplete);\n        var delay = getDelayFromTransition(transition, key);\n        var start = function () { return (controls = animation()); };\n        if (delay) {\n            delayTimer = window.setTimeout(start, secondsToMilliseconds(delay));\n        }\n        else {\n            start();\n        }\n        return function () {\n            clearTimeout(delayTimer);\n            controls === null || controls === void 0 ? void 0 : controls.stop();\n        };\n    });\n}\n\nexport { convertTransitionToAnimationOptions, getDelayFromTransition, getPopmotionAnimationOptions, getValueTransition, getZeroUnit, hydrateKeyframes, isTransitionDefined, isZero, startAnimation };\n"],"names":["isTransitionDefined","_a","when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from","transition","__rest","Object","keys","length","legacyRepeatWarning","convertTransitionToAnimationOptions","ease","times","yoyo","flip","loop","options","__assign","duration","secondsToMilliseconds","isEasingArray","map","easingDefinitionToFunction","type","warning","getDelayFromTransition","key","_b","getValueTransition","hydrateKeyframes","Array","isArray","to","__spreadArray","__read","getPopmotionAnimationOptions","getDefaultTransition","isZero","value","parseFloat","indexOf","getZeroUnit","potentialUnitType","getAnimatableNone","startAnimation","target","instantAnimationState","current","start","onComplete","delayTimer","controls","animation","valueTransition","origin","get","isTargetAnimatable","isAnimatable","isOriginAnimatable","concat","velocity","getVelocity","onUpdate","v","set","inertia","animate","call","finalTarget","resolveFinalValueInKeyframes","stop","getAnimation","window","setTimeout","clearTimeout"],"mappings":"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"}