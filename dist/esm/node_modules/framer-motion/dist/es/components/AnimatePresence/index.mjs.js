import{__read as e,__spreadArray as t}from"../../../../../tslib/tslib.es6.js";import"../../../../../react/index.js";import{env as r}from"../../utils/process.mjs.js";import{useForceUpdate as n}from"../../utils/use-force-update.mjs.js";import{useIsMounted as o}from"../../utils/use-is-mounted.mjs.js";import{PresenceChild as i}from"./PresenceChild.mjs.js";import{LayoutGroupContext as s}from"../../context/LayoutGroupContext.mjs.js";import{useIsomorphicLayoutEffect as u}from"../../utils/use-isomorphic-effect.mjs.js";import{useUnmountEffect as c}from"../../utils/use-unmount-effect.mjs.js";import{r as f}from"../../../../../../_virtual/index.js";var a=function(e){return e.key||""};var m=function(m){var p=m.children,l=m.custom,x=m.initial,d=void 0===x||x,v=m.onExitComplete,j=m.exitBeforeEnter,h=m.presenceAffectsLayout,E=void 0===h||h,y=e(n(),1)[0],g=f.exports.useContext(s).forceRender;g&&(y=g);var k=o(),C=function(e){var t=[];return f.exports.Children.forEach(e,(function(e){f.exports.isValidElement(e)&&t.push(e)})),t}(p),w=C,A=new Set,L=f.exports.useRef(w),P=f.exports.useRef(new Map).current,b=f.exports.useRef(!0);if(u((function(){b.current=!1,function(e,t){e.forEach((function(e){var r=a(e);t.set(r,e)}))}(C,P),L.current=w})),c((function(){b.current=!0,P.clear(),A.clear()})),b.current)return f.exports.createElement(f.exports.Fragment,null,w.map((function(e){return f.exports.createElement(i,{key:a(e),isPresent:!0,initial:!!d&&void 0,presenceAffectsLayout:E},e)})));w=t([],e(w),!1);for(var R=L.current.map(a),z=C.map(a),O=R.length,B=0;B<O;B++){var F=R[B];-1===z.indexOf(F)&&A.add(F)}return j&&A.size&&(w=[]),A.forEach((function(e){if(-1===z.indexOf(e)){var t=P.get(e);if(t){var r=R.indexOf(e);w.splice(r,0,f.exports.createElement(i,{key:a(t),isPresent:!1,onExitComplete:function(){P.delete(e),A.delete(e);var t=L.current.findIndex((function(t){return t.key===e}));if(L.current.splice(t,1),!A.size){if(L.current=C,!1===k.current)return;y(),v&&v()}},custom:l,presenceAffectsLayout:E},t))}}})),w=w.map((function(e){var t=e.key;return A.has(t)?e:f.exports.createElement(i,{key:a(e),isPresent:!0,presenceAffectsLayout:E},e)})),"production"!==r&&j&&w.length>1&&console.warn("You're attempting to animate multiple children within AnimatePresence, but its exitBeforeEnter prop is set to true. This will lead to odd visual behaviour."),f.exports.createElement(f.exports.Fragment,null,A.size?w:w.map((function(e){return f.exports.cloneElement(e)})))};export{m as AnimatePresence};
//# sourceMappingURL=index.mjs.js.map
