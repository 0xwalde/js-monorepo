import{__spreadArray as t,__read as n,__assign as i,__rest as e}from"../../../../../tslib/tslib.es6.js";import{isAnimationControls as r}from"../../animation/utils/is-animation-controls.mjs.js";import{isKeyframesTarget as o}from"../../animation/utils/is-keyframes-target.mjs.js";import{shallowCompare as a}from"../../utils/shallow-compare.mjs.js";import{animateVisualElement as s}from"./animation.mjs.js";import{AnimationType as u}from"./types.mjs.js";import{isVariantLabels as v,resolveVariant as m,isVariantLabel as l}from"./variants.mjs.js";var c=[u.Animate,u.InView,u.Focus,u.Hover,u.Tap,u.Drag,u.Exit],p=t([],n(c),!1).reverse(),f=c.length;function d(v){var c,d=function(t){return function(n){return Promise.all(n.map((function(n){var i=n.animation,e=n.options;return s(t,i,e)})))}}(v),g=((c={})[u.Animate]=y(!0),c[u.InView]=y(),c[u.Hover]=y(),c[u.Tap]=y(),c[u.Drag]=y(),c[u.Focus]=y(),c[u.Exit]=y(),c),j={},h=!0,P=function(t,n){var r=m(v,n);if(r){r.transition;var o=r.transitionEnd,a=e(r,["transition","transitionEnd"]);t=i(i(i({},t),a),o)}return t};function E(e,s){for(var u,m=v.getProps(),c=v.getVariantContext(!0)||{},y=[],E=new Set,V={},w=1/0,K=function(f){var d=p[f],j=g[d],K=null!==(u=m[d])&&void 0!==u?u:c[d],b=l(K),x=d===s?j.isActive:null;!1===x&&(w=f);var C=K===c[d]&&K!==m[d]&&b;if(C&&h&&v.manuallyAnimateOnMount&&(C=!1),j.protectedKeys=i({},V),!j.isActive&&null===x||!K&&!j.prevProp||r(K)||"boolean"==typeof K)return"continue";var F=A(j.prevProp,K),I=F||d===s&&j.isActive&&!C&&b||f>w&&b,O=Array.isArray(K)?K:[K],R=O.reduce(P,{});!1===x&&(R={});var S=j.prevResolvedValues,T=void 0===S?{}:S,k=i(i({},T),R),B=function(t){I=!0,E.delete(t),j.needsAnimating[t]=!0};for(var D in k){var H=R[D],M=T[D];V.hasOwnProperty(D)||(H!==M?o(H)&&o(M)?!a(H,M)||F?B(D):j.protectedKeys[D]=!0:void 0!==H?B(D):E.add(D):void 0!==H&&E.has(D)?B(D):j.protectedKeys[D]=!0)}j.prevProp=K,j.prevResolvedValues=R,j.isActive&&(V=i(i({},V),R)),h&&v.blockInitialAnimation&&(I=!1),I&&!C&&y.push.apply(y,t([],n(O.map((function(t){return{animation:t,options:i({type:d},e)}}))),!1))},b=0;b<f;b++)K(b);if(j=i({},V),E.size){var x={};E.forEach((function(t){var n=v.getBaseTarget(t);void 0!==n&&(x[t]=n)})),y.push({animation:x})}var C=Boolean(y.length);return h&&!1===m.initial&&!v.manuallyAnimateOnMount&&(C=!1),h=!1,C?d(y):Promise.resolve()}return{isAnimated:function(t){return void 0!==j[t]},animateChanges:E,setActive:function(t,n,i){var e;if(g[t].isActive===n)return Promise.resolve();null===(e=v.variantChildren)||void 0===e||e.forEach((function(i){var e;return null===(e=i.animationState)||void 0===e?void 0:e.setActive(t,n)})),g[t].isActive=n;var r=E(i,t);for(var o in g)g[o].protectedKeys={};return r},setAnimateFunction:function(t){d=t(v)},getState:function(){return g}}}function A(t,n){return"string"==typeof n?n!==t:!!v(n)&&!a(n,t)}function y(t){return void 0===t&&(t=!1),{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}export{A as checkVariantsDidChange,d as createAnimationState,c as variantPriorityOrder};
//# sourceMappingURL=animation-state.mjs.js.map
