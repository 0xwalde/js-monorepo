import{__assign as e,__spreadArray as n,__read as t}from"../../../../tslib/tslib.es6.js";import r,{cancelSync as i}from"../../../node_modules/framesync/dist/es/index.mjs.js";import{motionValue as o}from"../value/index.mjs.js";import{isMotionValue as a}from"../value/utils/is-motion-value.mjs.js";import{variantPriorityOrder as u}from"./utils/animation-state.mjs.js";import{createLifecycles as l}from"./utils/lifecycles.mjs.js";import{updateMotionValuesFromProps as s}from"./utils/motion-values.mjs.js";import{checkIfControllingVariants as d,checkIfVariantNode as c,isVariantLabel as f}from"./utils/variants.mjs.js";var v=function(n){var t=n.treeType,u=void 0===t?"":t,v=n.build,g=n.getBaseTarget,V=n.makeTargetAnimatable,h=n.measureViewportBox,j=n.render,b=n.readValueFromInstance,y=n.removeValueFromRenderState,C=n.sortNodePosition,T=n.scrapeMotionValuesFromProps;return function(n,t){var P=n.parent,I=n.props,R=n.presenceId,x=n.blockInitialAnimation,M=n.visualState,B=n.shouldReduceMotion;void 0===t&&(t={});var S,w,A=!1,N=M.latestValues,k=M.renderState,E=l(),L=new Map,F=new Map,U={},q=e({},N);function D(){S&&A&&(O(),j(S,k,I.style,W.projection))}function O(){v(W,k,N,t,I)}function _(){E.notifyUpdate(N)}function z(e,n){var t=n.onChange((function(n){N[e]=n,I.onUpdate&&r.update(_,!1,!0)})),i=n.onRenderRequest(W.scheduleRender);F.set(e,(function(){t(),i()}))}var G=T(I);for(var H in G){var J=G[H];void 0!==N[H]&&a(J)&&J.set(N[H],!1)}var K=d(I),Q=c(I),W=e(e({treeType:u,current:null,depth:P?P.depth+1:0,parent:P,children:new Set,presenceId:R,shouldReduceMotion:B,variantChildren:Q?new Set:void 0,isVisible:void 0,manuallyAnimateOnMount:Boolean(null==P?void 0:P.isMounted()),blockInitialAnimation:x,isMounted:function(){return Boolean(S)},mount:function(e){A=!0,S=W.current=e,W.projection&&W.projection.mount(e),Q&&P&&!K&&(w=null==P?void 0:P.addVariantChild(W)),L.forEach((function(e,n){return z(n,e)})),null==P||P.children.add(W),W.setProps(I)},unmount:function(){var e;null===(e=W.projection)||void 0===e||e.unmount(),i.update(_),i.render(D),F.forEach((function(e){return e()})),null==w||w(),null==P||P.children.delete(W),E.clearAllListeners(),S=void 0,A=!1},addVariantChild:function(e){var n,t=W.getClosestVariantNode();if(t)return null===(n=t.variantChildren)||void 0===n||n.add(e),function(){return t.variantChildren.delete(e)}},sortNodePosition:function(e){return C&&u===e.treeType?C(W.getInstance(),e.getInstance()):0},getClosestVariantNode:function(){return Q?W:null==P?void 0:P.getClosestVariantNode()},getLayoutId:function(){return I.layoutId},getInstance:function(){return S},getStaticValue:function(e){return N[e]},setStaticValue:function(e,n){return N[e]=n},getLatestValues:function(){return N},setVisibility:function(e){W.isVisible!==e&&(W.isVisible=e,W.scheduleRender())},makeTargetAnimatable:function(e,n){return void 0===n&&(n=!0),V(W,e,I,n)},measureViewportBox:function(){return h(S,I)},addValue:function(e,n){W.hasValue(e)&&W.removeValue(e),L.set(e,n),N[e]=n.get(),z(e,n)},removeValue:function(e){var n;L.delete(e),null===(n=F.get(e))||void 0===n||n(),F.delete(e),delete N[e],y(e,k)},hasValue:function(e){return L.has(e)},getValue:function(e,n){var t=L.get(e);return void 0===t&&void 0!==n&&(t=o(n),W.addValue(e,t)),t},forEachValue:function(e){return L.forEach(e)},readValue:function(e){var n;return null!==(n=N[e])&&void 0!==n?n:b(S,e,t)},setBaseTarget:function(e,n){q[e]=n},getBaseTarget:function(e){if(g){var n=g(I,e);if(void 0!==n&&!a(n))return n}return q[e]}},E),{build:function(){return O(),k},scheduleRender:function(){r.render(D,!1,!0)},syncRender:D,setProps:function(e){(e.transformTemplate||I.transformTemplate)&&W.scheduleRender(),I=e,E.updatePropListeners(e),U=s(W,T(I),U)},getProps:function(){return I},getVariant:function(e){var n;return null===(n=I.variants)||void 0===n?void 0:n[e]},getDefaultTransition:function(){return I.transition},getTransformPagePoint:function(){return I.transformPagePoint},getVariantContext:function(e){if(void 0===e&&(e=!1),e)return null==P?void 0:P.getVariantContext();if(!K){var n=(null==P?void 0:P.getVariantContext())||{};return void 0!==I.initial&&(n.initial=I.initial),n}for(var t={},r=0;r<p;r++){var i=m[r],o=I[i];(f(o)||!1===o)&&(t[i]=o)}return t}});return W}},m=n(["initial"],t(u),!1),p=m.length;export{v as visualElement};
//# sourceMappingURL=index.mjs.js.map
