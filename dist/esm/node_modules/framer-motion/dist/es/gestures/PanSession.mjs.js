import{__assign as t}from"../../../../tslib/tslib.es6.js";import{isMouseEvent as n,isTouchEvent as e}from"./utils/event-type.mjs.js";import{extractEventInfo as o}from"../events/event-info.mjs.js";import i,{getFrameData as s,cancelSync as r}from"../../../node_modules/framesync/dist/es/index.mjs.js";import{secondsToMilliseconds as a}from"../utils/time-conversion.mjs.js";import{addPointerEvent as m}from"../events/use-pointer-event.mjs.js";import{distance as v}from"../../../../popmotion/dist/es/utils/distance.mjs.js";import{pipe as p}from"../../../../popmotion/dist/es/utils/pipe.mjs.js";var l=function(){function a(r,a,l){var f=this,d=(void 0===l?{}:l).transformPagePoint;if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=function(){if(f.lastMoveEvent&&f.lastMoveEventInfo){var n=h(f.lastMoveEventInfo,f.history),e=null!==f.startEvent,o=v(n.offset,{x:0,y:0})>=3;if(e||o){var i=n.point,r=s().timestamp;f.history.push(t(t({},i),{timestamp:r}));var a=f.handlers,m=a.onStart,p=a.onMove;e||(m&&m(f.lastMoveEvent,n),f.startEvent=f.lastMoveEvent),p&&p(f.lastMoveEvent,n)}}},this.handlePointerMove=function(t,e){f.lastMoveEvent=t,f.lastMoveEventInfo=u(e,f.transformPagePoint),n(t)&&0===t.buttons?f.handlePointerUp(t,e):i.update(f.updatePoint,!0)},this.handlePointerUp=function(t,n){f.end();var e=f.handlers,o=e.onEnd,i=e.onSessionEnd,s=h(u(n,f.transformPagePoint),f.history);f.startEvent&&o&&o(t,s),i&&i(t,s)},!(e(r)&&r.touches.length>1)){this.handlers=a,this.transformPagePoint=d;var y=u(o(r),this.transformPagePoint),c=y.point,P=s().timestamp;this.history=[t(t({},c),{timestamp:P})];var E=a.onSessionStart;E&&E(r,h(y,this.history)),this.removeListeners=p(m(window,"pointermove",this.handlePointerMove),m(window,"pointerup",this.handlePointerUp),m(window,"pointercancel",this.handlePointerUp))}}return a.prototype.updateHandlers=function(t){this.handlers=t},a.prototype.end=function(){this.removeListeners&&this.removeListeners(),r.update(this.updatePoint)},a}();function u(t,n){return n?{point:n(t.point)}:t}function f(t,n){return{x:t.x-n.x,y:t.y-n.y}}function h(t,n){var e=t.point;return{point:e,delta:f(e,y(n)),offset:f(e,d(n)),velocity:c(n,.1)}}function d(t){return t[0]}function y(t){return t[t.length-1]}function c(t,n){if(t.length<2)return{x:0,y:0};for(var e=t.length-1,o=null,i=y(t);e>=0&&(o=t[e],!(i.timestamp-o.timestamp>a(n)));)e--;if(!o)return{x:0,y:0};var s=(i.timestamp-o.timestamp)/1e3;if(0===s)return{x:0,y:0};var r={x:(i.x-o.x)/s,y:(i.y-o.y)/s};return r.x===1/0&&(r.x=0),r.y===1/0&&(r.y=0),r}export{l as PanSession};
//# sourceMappingURL=PanSession.mjs.js.map
