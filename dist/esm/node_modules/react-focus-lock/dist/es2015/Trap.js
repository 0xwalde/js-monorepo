import"../../../react/index.js";import"../../../prop-types/index.js";import e from"../../../react-clientside-effect/lib/index.es.js";import{focusInside as n}from"../../../focus-lock/dist/es2015/focusInside.js";import{focusIsHidden as t}from"../../../focus-lock/dist/es2015/focusIsHidden.js";import{getFocusabledIn as o}from"../../../focus-lock/dist/es2015/focusables.js";import{setFocus as r}from"../../../focus-lock/dist/es2015/setFocus.js";import{deferAction as u}from"./util.js";import{mediumFocus as i,mediumBlur as s,mediumEffect as c}from"./medium.js";import{p as d}from"../../../../_virtual/index6.js";var a=function(){return document&&document.activeElement===document.body||t()},f=null,m=null,l=null,v=!1,p=function(){return!0};function E(e,n,t,o){var r=null,u=e;do{var i=o[u];if(i.guard)i.node.dataset.focusAutoGuard&&(r=i);else{if(!i.lockItem)break;if(u!==e)return;r=null}}while((u+=t)!==n);r&&(r.node.tabIndex=0)}var b=function(e){return e&&"current"in e?e.current:e},j=function e(n,t,o){return t&&(t.host===n&&(!t.activeElement||o.contains(t.activeElement))||t.parentNode&&e(n,t.parentNode,o))},g=function(){var e,t=!1;if(f){var u=f,i=u.observed,s=u.persistentFocus,c=u.autoFocus,d=u.shards,g=u.crossFrame,h=u.focusOptions,x=i||l&&l.portaledElement,w=document&&document.activeElement;if(x){var I=[x].concat(d.map(b).filter(Boolean));if(w&&!function(e){return(f.whiteList||p)(e)}(w)||(s||(g?Boolean(v):"meanwhile"===v)||!a()||!m&&c)&&(x&&!(n(I)||w&&function(e,n){return n.some((function(n){return j(e,n,n)}))}(w,I)||(e=w,l&&l.portaledElement===e))&&(document&&!m&&w&&!c?(w.blur&&w.blur(),document.body.focus()):(t=r(I,m,{focusOptions:h}),l={})),v=!1,m=document&&document.activeElement),document){var L=document&&document.activeElement,k=o(I),F=k.map((function(e){return e.node})).indexOf(L);F>-1&&(k.filter((function(e){var n=e.guard,t=e.node;return n&&t.dataset.focusAutoGuard})).forEach((function(e){return e.node.removeAttribute("tabIndex")})),E(F,k.length,1,k),E(F,-1,-1,k))}}}return t},h=function(e){g()&&e&&(e.stopPropagation(),e.preventDefault())},x=function(){return u(g)};"production"===process.env.NODE_ENV||d.exports.node.isRequired;var w=function(){v="just",setTimeout((function(){v="meanwhile"}),0)};i.assignSyncMedium((function(e){var n=e.target,t=e.currentTarget;t.contains(n)||(l={observerNode:t,portaledElement:n})})),s.assignMedium(x),c.assignMedium((function(e){return e({moveFocusInside:r,focusInside:n})}));var I=e((function(e){return e.filter((function(e){return!e.disabled}))}),(function(e){var n=e.slice(-1)[0];n&&!f&&(document.addEventListener("focusin",h),document.addEventListener("focusout",x),window.addEventListener("blur",w));var t=f,o=t&&n&&n.id===t.id;f=n,t&&!o&&(t.onDeactivation(),e.filter((function(e){return e.id===t.id})).length||t.returnFocus(!n)),n?(m=null,o&&t.observed===n.observed||n.onActivation(),g(),u(g)):(document.removeEventListener("focusin",h),document.removeEventListener("focusout",x),window.removeEventListener("blur",w),m=null)}))((function(){return null}));export{I as default};
//# sourceMappingURL=Trap.js.map
