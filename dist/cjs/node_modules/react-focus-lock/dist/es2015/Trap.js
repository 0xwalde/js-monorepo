"use strict";require("../../../react/index.js"),require("../../../prop-types/index.js");var e=require("../../../react-clientside-effect/lib/index.es.js"),n=require("../../../focus-lock/dist/es2015/focusInside.js"),t=require("../../../focus-lock/dist/es2015/focusIsHidden.js"),u=require("../../../focus-lock/dist/es2015/focusables.js"),o=require("../../../focus-lock/dist/es2015/setFocus.js"),r=require("./util.js"),i=require("./medium.js"),s=require("../../../../_virtual/index6.js"),c=function(){return document&&document.activeElement===document.body||t.focusIsHidden()},d=null,a=null,f=null,l=!1,m=function(){return!0};function v(e,n,t,u){var o=null,r=e;do{var i=u[r];if(i.guard)i.node.dataset.focusAutoGuard&&(o=i);else{if(!i.lockItem)break;if(r!==e)return;o=null}}while((r+=t)!==n);o&&(o.node.tabIndex=0)}var p=function(e){return e&&"current"in e?e.current:e},E=function e(n,t,u){return t&&(t.host===n&&(!t.activeElement||u.contains(t.activeElement))||t.parentNode&&e(n,t.parentNode,u))},b=function(){var e,t=!1;if(d){var r=d,i=r.observed,s=r.persistentFocus,b=r.autoFocus,g=r.shards,j=r.crossFrame,q=r.focusOptions,I=i||f&&f.portaledElement,F=document&&document.activeElement;if(I){var h=[I].concat(g.map(p).filter(Boolean));if(F&&!function(e){return(d.whiteList||m)(e)}(F)||(s||(j?Boolean(l):"meanwhile"===l)||!c()||!a&&b)&&(I&&!(n.focusInside(h)||F&&function(e,n){return n.some((function(n){return E(e,n,n)}))}(F,h)||(e=F,f&&f.portaledElement===e))&&(document&&!a&&F&&!b?(F.blur&&F.blur(),document.body.focus()):(t=o.setFocus(h,a,{focusOptions:q}),f={})),l=!1,a=document&&document.activeElement),document){var x=document&&document.activeElement,w=u.getFocusabledIn(h),L=w.map((function(e){return e.node})).indexOf(x);L>-1&&(w.filter((function(e){var n=e.guard,t=e.node;return n&&t.dataset.focusAutoGuard})).forEach((function(e){return e.node.removeAttribute("tabIndex")})),v(L,w.length,1,w),v(L,-1,-1,w))}}}return t},g=function(e){b()&&e&&(e.stopPropagation(),e.preventDefault())},j=function(){return r.deferAction(b)};"production"===process.env.NODE_ENV||s.propTypes.exports.node.isRequired;var q=function(){l="just",setTimeout((function(){l="meanwhile"}),0)};i.mediumFocus.assignSyncMedium((function(e){var n=e.target,t=e.currentTarget;t.contains(n)||(f={observerNode:t,portaledElement:n})})),i.mediumBlur.assignMedium(j),i.mediumEffect.assignMedium((function(e){return e({moveFocusInside:o.setFocus,focusInside:n.focusInside})}));var I=e((function(e){return e.filter((function(e){return!e.disabled}))}),(function(e){var n=e.slice(-1)[0];n&&!d&&(document.addEventListener("focusin",g),document.addEventListener("focusout",j),window.addEventListener("blur",q));var t=d,u=t&&n&&n.id===t.id;d=n,t&&!u&&(t.onDeactivation(),e.filter((function(e){return e.id===t.id})).length||t.returnFocus(!n)),n?(a=null,u&&t.observed===n.observed||n.onActivation(),b(),r.deferAction(b)):(document.removeEventListener("focusin",g),document.removeEventListener("focusout",j),window.removeEventListener("blur",q),a=null)}))((function(){return null}));module.exports=I;
//# sourceMappingURL=Trap.js.map
