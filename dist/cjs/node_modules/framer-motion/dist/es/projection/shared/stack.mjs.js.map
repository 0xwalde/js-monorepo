{"version":3,"file":"stack.mjs.js","sources":["../../../../../../../../node_modules/framer-motion/dist/es/projection/shared/stack.mjs"],"sourcesContent":["import { addUniqueItem, removeItem } from '../../utils/array.mjs';\n\nvar NodeStack = /** @class */ (function () {\n    function NodeStack() {\n        this.members = [];\n    }\n    NodeStack.prototype.add = function (node) {\n        addUniqueItem(this.members, node);\n        node.scheduleRender();\n    };\n    NodeStack.prototype.remove = function (node) {\n        removeItem(this.members, node);\n        if (node === this.prevLead) {\n            this.prevLead = undefined;\n        }\n        if (node === this.lead) {\n            var prevLead = this.members[this.members.length - 1];\n            if (prevLead) {\n                this.promote(prevLead);\n            }\n        }\n    };\n    NodeStack.prototype.relegate = function (node) {\n        var indexOfNode = this.members.findIndex(function (member) { return node === member; });\n        if (indexOfNode === 0)\n            return false;\n        /**\n         * Find the next projection node that is present\n         */\n        var prevLead;\n        for (var i = indexOfNode; i >= 0; i--) {\n            var member = this.members[i];\n            if (member.isPresent !== false) {\n                prevLead = member;\n                break;\n            }\n        }\n        if (prevLead) {\n            this.promote(prevLead);\n            return true;\n        }\n        else {\n            return false;\n        }\n    };\n    NodeStack.prototype.promote = function (node, preserveFollowOpacity) {\n        var _a;\n        var prevLead = this.lead;\n        if (node === prevLead)\n            return;\n        this.prevLead = prevLead;\n        this.lead = node;\n        node.show();\n        if (prevLead) {\n            prevLead.instance && prevLead.scheduleRender();\n            node.scheduleRender();\n            node.resumeFrom = prevLead;\n            if (preserveFollowOpacity) {\n                node.resumeFrom.preserveOpacity = true;\n            }\n            if (prevLead.snapshot) {\n                node.snapshot = prevLead.snapshot;\n                node.snapshot.latestValues =\n                    prevLead.animationValues || prevLead.latestValues;\n                node.snapshot.isShared = true;\n            }\n            if ((_a = node.root) === null || _a === void 0 ? void 0 : _a.isUpdating) {\n                node.isLayoutDirty = true;\n            }\n            var crossfade = node.options.crossfade;\n            if (crossfade === false) {\n                prevLead.hide();\n            }\n            /**\n             * TODO:\n             *   - Test border radius when previous node was deleted\n             *   - boxShadow mixing\n             *   - Shared between element A in scrolled container and element B (scroll stays the same or changes)\n             *   - Shared between element A in transformed container and element B (transform stays the same or changes)\n             *   - Shared between element A in scrolled page and element B (scroll stays the same or changes)\n             * ---\n             *   - Crossfade opacity of root nodes\n             *   - layoutId changes after animation\n             *   - layoutId changes mid animation\n             */\n        }\n    };\n    NodeStack.prototype.exitAnimationComplete = function () {\n        this.members.forEach(function (node) {\n            var _a, _b, _c, _d, _e;\n            (_b = (_a = node.options).onExitComplete) === null || _b === void 0 ? void 0 : _b.call(_a);\n            (_e = (_c = node.resumingFrom) === null || _c === void 0 ? void 0 : (_d = _c.options).onExitComplete) === null || _e === void 0 ? void 0 : _e.call(_d);\n        });\n    };\n    NodeStack.prototype.scheduleRender = function () {\n        this.members.forEach(function (node) {\n            node.instance && node.scheduleRender(false);\n        });\n    };\n    /**\n     * Clear any leads that have been removed this render to prevent them from being\n     * used in future animations and to prevent memory leaks\n     */\n    NodeStack.prototype.removeLeadSnapshot = function () {\n        if (this.lead && this.lead.snapshot) {\n            this.lead.snapshot = undefined;\n        }\n    };\n    return NodeStack;\n}());\n\nexport { NodeStack };\n"],"names":["NodeStack","this","members","prototype","add","node","addUniqueItem","scheduleRender","remove","removeItem","prevLead","undefined","lead","length","promote","relegate","indexOfNode","findIndex","member","i","isPresent","preserveFollowOpacity","_a","show","instance","resumeFrom","preserveOpacity","snapshot","latestValues","animationValues","isShared","root","isUpdating","isLayoutDirty","options","crossfade","hide","exitAnimationComplete","forEach","_b","_c","_d","_e","onExitComplete","call","resumingFrom","removeLeadSnapshot"],"mappings":"8GAEIA,EAA2B,WAC3B,SAASA,IACLC,KAAKC,QAAU,EAClB,CAuGD,OAtGAF,EAAUG,UAAUC,IAAM,SAAUC,GAChCC,EAAAA,cAAcL,KAAKC,QAASG,GAC5BA,EAAKE,gBACb,EACIP,EAAUG,UAAUK,OAAS,SAAUH,GAKnC,GAJAI,EAAAA,WAAWR,KAAKC,QAASG,GACrBA,IAASJ,KAAKS,WACdT,KAAKS,cAAWC,GAEhBN,IAASJ,KAAKW,KAAM,CACpB,IAAIF,EAAWT,KAAKC,QAAQD,KAAKC,QAAQW,OAAS,GAC9CH,GACAT,KAAKa,QAAQJ,EAEpB,CACT,EACIV,EAAUG,UAAUY,SAAW,SAAUV,GACrC,IAMIK,EANAM,EAAcf,KAAKC,QAAQe,WAAU,SAAUC,GAAU,OAAOb,IAASa,CAAO,IACpF,GAAoB,IAAhBF,EACA,OAAO,EAKX,IAAK,IAAIG,EAAIH,EAAaG,GAAK,EAAGA,IAAK,CACnC,IAAID,EAASjB,KAAKC,QAAQiB,GAC1B,IAAyB,IAArBD,EAAOE,UAAqB,CAC5BV,EAAWQ,EACX,KACH,CACJ,CACD,QAAIR,IACAT,KAAKa,QAAQJ,IACN,EAKnB,EACIV,EAAUG,UAAUW,QAAU,SAAUT,EAAMgB,GAC1C,IAAIC,EACAZ,EAAWT,KAAKW,KAChBP,IAASK,IAEbT,KAAKS,SAAWA,EAChBT,KAAKW,KAAOP,EACZA,EAAKkB,OACDb,IACAA,EAASc,UAAYd,EAASH,iBAC9BF,EAAKE,iBACLF,EAAKoB,WAAaf,EACdW,IACAhB,EAAKoB,WAAWC,iBAAkB,GAElChB,EAASiB,WACTtB,EAAKsB,SAAWjB,EAASiB,SACzBtB,EAAKsB,SAASC,aACVlB,EAASmB,iBAAmBnB,EAASkB,aACzCvB,EAAKsB,SAASG,UAAW,IAEJ,QAApBR,EAAKjB,EAAK0B,YAAyB,IAAPT,OAAgB,EAASA,EAAGU,cACzD3B,EAAK4B,eAAgB,IAGP,IADF5B,EAAK6B,QAAQC,WAEzBzB,EAAS0B,QAezB,EACIpC,EAAUG,UAAUkC,sBAAwB,WACxCpC,KAAKC,QAAQoC,SAAQ,SAAUjC,GAC3B,IAAIiB,EAAIiB,EAAIC,EAAIC,EAAIC,EAC0B,QAA7CH,GAAMjB,EAAKjB,EAAK6B,SAASS,sBAAmC,IAAPJ,GAAyBA,EAAGK,KAAKtB,GACmB,QAAzGoB,EAAkC,QAA5BF,EAAKnC,EAAKwC,oBAAiC,IAAPL,OAAgB,GAAUC,EAAKD,EAAGN,SAASS,sBAAmC,IAAPD,GAAyBA,EAAGE,KAAKH,EAC/J,GACA,EACIzC,EAAUG,UAAUI,eAAiB,WACjCN,KAAKC,QAAQoC,SAAQ,SAAUjC,GAC3BA,EAAKmB,UAAYnB,EAAKE,gBAAe,EACjD,GACA,EAKIP,EAAUG,UAAU2C,mBAAqB,WACjC7C,KAAKW,MAAQX,KAAKW,KAAKe,WACvB1B,KAAKW,KAAKe,cAAWhB,EAEjC,EACWX,CACX"}