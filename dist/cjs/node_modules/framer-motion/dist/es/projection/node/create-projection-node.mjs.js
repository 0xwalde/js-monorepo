"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../../../../tslib/tslib.es6.js"),e=require("../../../../node_modules/framesync/dist/es/index.mjs.js"),i=require("../../animation/animate.mjs.js"),o=require("../../utils/subscription-manager.mjs.js"),a=require("../animation/mix-values.mjs.js"),s=require("../geometry/copy.mjs.js"),r=require("../geometry/delta-apply.mjs.js"),n=require("../geometry/delta-calc.mjs.js"),l=require("../geometry/delta-remove.mjs.js"),h=require("../geometry/models.mjs.js"),u=require("../../animation/utils/transitions.mjs.js"),c=require("../geometry/utils.mjs.js"),p=require("../shared/stack.mjs.js"),d=require("../styles/scale-correction.mjs.js"),m=require("../styles/transform.mjs.js"),v=require("../utils/each-axis.mjs.js"),y=require("../utils/has-transform.mjs.js"),f=require("../../render/html/utils/transform.mjs.js"),g=require("../../render/utils/flat-tree.mjs.js"),x=require("../../value/utils/resolve-motion-value.mjs.js"),T=require("./state.mjs.js"),j=require("../../../../../popmotion/dist/es/utils/mix.mjs.js");function S(t){t.updateLayout()}function P(t){var e,i,o,a,s=null!==(i=null===(e=t.resumeFrom)||void 0===e?void 0:e.snapshot)&&void 0!==i?i:t.snapshot;if(t.isLead()&&t.layout&&s&&t.hasListeners("didUpdate")){var r=t.layout,l=r.actual,u=r.measured;"size"===t.options.animationType?v.eachAxis((function(t){var e=s.isShared?s.measured[t]:s.layout[t],i=n.calcLength(e);e.min=l[t].min,e.max=e.min+i})):"position"===t.options.animationType&&v.eachAxis((function(t){var e=s.isShared?s.measured[t]:s.layout[t],i=n.calcLength(l[t]);e.max=e.min+i}));var p=h.createDelta();n.calcBoxDelta(p,l,s.layout);var d=h.createDelta();s.isShared?n.calcBoxDelta(d,t.applyTransform(u,!0),s.measured):n.calcBoxDelta(d,l,s.layout);var m=!c.isDeltaZero(p),y=!1;if(!t.resumeFrom&&(t.relativeParent=t.getClosestProjectingParent(),t.relativeParent&&!t.relativeParent.resumeFrom)){var f=t.relativeParent,g=f.snapshot,x=f.layout;if(g&&x){var T=h.createBox();n.calcRelativePosition(T,s.layout,g.layout);var j=h.createBox();n.calcRelativePosition(j,l,x.actual),c.boxEquals(T,j)||(y=!0)}}t.notifyListeners("didUpdate",{layout:l,snapshot:s,delta:d,layoutDelta:p,hasLayoutChanged:m,hasRelativeTargetChanged:y})}else t.isLead()&&(null===(a=(o=t.options).onExitComplete)||void 0===a||a.call(o));t.options.transition=void 0}function B(t){t.clearSnapshot()}function A(t){t.clearMeasurements()}function D(t){var e=t.options.visualElement;(null==e?void 0:e.getProps().onBeforeLayoutMeasure)&&e.notifyBeforeLayoutMeasure(),t.resetTransform()}function V(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0}function R(t){t.resolveTargetDelta()}function L(t){t.calcProjection()}function E(t){t.resetRotation()}function k(t){t.removeLeadSnapshot()}function F(t,e,i){t.translate=j.mix(e.translate,0,i),t.scale=j.mix(e.scale,1,i),t.origin=e.origin,t.originPoint=e.originPoint}function U(t,e,i,o){t.min=j.mix(e.min,i.min,o),t.max=j.mix(e.max,i.max,o)}function _(t,e,i,o){U(t.x,e.x,i.x,o),U(t.y,e.y,i.y,o)}function C(t){return t.animationValues&&void 0!==t.animationValues.opacityExit}var q={duration:.45,ease:[.4,0,.1,1]};function b(t,e){for(var i=t.root,o=t.path.length-1;o>=0;o--)if(Boolean(t.path[o].instance)){i=t.path[o];break}var a=(i&&i!==t.root?i.instance:document).querySelector('[data-projection-id="'.concat(e,'"]'));a&&t.mount(a,!0)}function I(t){t.min=Math.round(t.min),t.max=Math.round(t.max)}function M(t){I(t.x),I(t.y)}exports.createProjectionNode=function(v){var j=v.attachResizeListener,U=v.defaultParent,I=v.measureScroll,O=v.checkIsScrollRoot,N=v.resetTransform;return function(){function v(e,i,o){var a=this;void 0===i&&(i={}),void 0===o&&(o=null==U?void 0:U()),this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.potentialNodes=new Map,this.checkUpdateFailed=function(){a.isUpdating&&(a.isUpdating=!1,a.clearAllSnapshots())},this.updateProjection=function(){a.nodes.forEach(R),a.nodes.forEach(L)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.id=e,this.latestValues=i,this.root=o?o.root||o:this,this.path=o?t.__spreadArray(t.__spreadArray([],t.__read(o.path),!1),[o],!1):[],this.parent=o,this.depth=o?o.depth+1:0,e&&this.root.registerPotentialNode(e,this);for(var s=0;s<this.path.length;s++)this.path[s].shouldResetTransform=!0;this.root===this&&(this.nodes=new g.FlatTree)}return v.prototype.addEventListener=function(t,e){return this.eventHandlers.has(t)||this.eventHandlers.set(t,new o.SubscriptionManager),this.eventHandlers.get(t).add(e)},v.prototype.notifyListeners=function(e){for(var i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];var a=this.eventHandlers.get(e);null==a||a.notify.apply(a,t.__spreadArray([],t.__read(i),!1))},v.prototype.hasListeners=function(t){return this.eventHandlers.has(t)},v.prototype.registerPotentialNode=function(t,e){this.potentialNodes.set(t,e)},v.prototype.mount=function(e,i){var o,a=this;if(void 0===i&&(i=!1),!this.instance){this.isSVG=e instanceof SVGElement&&"svg"!==e.tagName,this.instance=e;var s=this.options,r=s.layoutId,n=s.layout,l=s.visualElement;if(l&&!l.getInstance()&&l.mount(e),this.root.nodes.add(this),null===(o=this.parent)||void 0===o||o.children.add(this),this.id&&this.root.potentialNodes.delete(this.id),i&&(n||r)&&(this.isLayoutDirty=!0),j){var h,p=function(){return a.root.updateBlockedByResize=!1};j(e,(function(){a.root.updateBlockedByResize=!0,clearTimeout(h),h=window.setTimeout(p,250),T.globalProjectionState.hasAnimatedSinceResize&&(T.globalProjectionState.hasAnimatedSinceResize=!1,a.nodes.forEach(V))}))}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&l&&(r||n)&&this.addEventListener("didUpdate",(function(e){var i,o,s,r,n,h=e.delta,p=e.hasLayoutChanged,d=e.hasRelativeTargetChanged,m=e.layout;if(a.isTreeAnimationBlocked())return a.target=void 0,void(a.relativeTarget=void 0);var v=null!==(o=null!==(i=a.options.transition)&&void 0!==i?i:l.getDefaultTransition())&&void 0!==o?o:q,y=l.getProps(),f=y.onLayoutAnimationStart,g=y.onLayoutAnimationComplete,x=!a.targetLayout||!c.boxEquals(a.targetLayout,m)||d,T=!p&&d;if((null===(s=a.resumeFrom)||void 0===s?void 0:s.instance)||T||p&&(x||!a.currentAnimation)){a.resumeFrom&&(a.resumingFrom=a.resumeFrom,a.resumingFrom.resumingFrom=void 0),a.setAnimationOrigin(h,T);var j=t.__assign(t.__assign({},u.getValueTransition(v,"layout")),{onPlay:f,onComplete:g});l.shouldReduceMotion&&(j.delay=0,j.type=!1),a.startAnimation(j)}else p||0!==a.animationProgress||a.finishAnimation(),a.isLead()&&(null===(n=(r=a.options).onExitComplete)||void 0===n||n.call(r));a.targetLayout=m}))}},v.prototype.unmount=function(){var t,i;this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this),null===(t=this.getStack())||void 0===t||t.remove(this),null===(i=this.parent)||void 0===i||i.children.delete(this),this.instance=void 0,e.cancelSync.preRender(this.updateProjection)},v.prototype.blockUpdate=function(){this.updateManuallyBlocked=!0},v.prototype.unblockUpdate=function(){this.updateManuallyBlocked=!1},v.prototype.isUpdateBlocked=function(){return this.updateManuallyBlocked||this.updateBlockedByResize},v.prototype.isTreeAnimationBlocked=function(){var t;return this.isAnimationBlocked||(null===(t=this.parent)||void 0===t?void 0:t.isTreeAnimationBlocked())||!1},v.prototype.startUpdate=function(){var t;this.isUpdateBlocked()||(this.isUpdating=!0,null===(t=this.nodes)||void 0===t||t.forEach(E))},v.prototype.willUpdate=function(t){var e,i,o;if(void 0===t&&(t=!0),this.root.isUpdateBlocked())null===(i=(e=this.options).onExitComplete)||void 0===i||i.call(e);else if(!this.root.isUpdating&&this.root.startUpdate(),!this.isLayoutDirty){this.isLayoutDirty=!0;for(var a=0;a<this.path.length;a++){var s=this.path[a];s.shouldResetTransform=!0,s.updateScroll()}var r=this.options,n=r.layoutId,l=r.layout;if(void 0!==n||l){var h=null===(o=this.options.visualElement)||void 0===o?void 0:o.getProps().transformTemplate;this.prevTransformTemplateValue=null==h?void 0:h(this.latestValues,""),this.updateSnapshot(),t&&this.notifyListeners("willUpdate")}}},v.prototype.didUpdate=function(){if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(A);this.isUpdating&&(this.isUpdating=!1,this.potentialNodes.size&&(this.potentialNodes.forEach(b),this.potentialNodes.clear()),this.nodes.forEach(D),this.nodes.forEach(S),this.nodes.forEach(P),this.clearAllSnapshots(),e.flushSync.update(),e.flushSync.preRender(),e.flushSync.render())},v.prototype.clearAllSnapshots=function(){this.nodes.forEach(B),this.sharedNodes.forEach(k)},v.prototype.scheduleUpdateProjection=function(){e.default.preRender(this.updateProjection,!1,!0)},v.prototype.scheduleCheckAfterUnmount=function(){var t=this;e.default.postRender((function(){t.isLayoutDirty?t.root.didUpdate():t.root.checkUpdateFailed()}))},v.prototype.updateSnapshot=function(){if(!this.snapshot&&this.instance){var t=this.measure(),e=this.removeTransform(this.removeElementScroll(t));M(e),this.snapshot={measured:t,layout:e,latestValues:{}}}},v.prototype.updateLayout=function(){var t;if(this.instance&&(this.updateScroll(),this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty)){if(this.resumeFrom&&!this.resumeFrom.instance)for(var e=0;e<this.path.length;e++){this.path[e].updateScroll()}var i=this.measure();M(i);var o=this.layout;this.layout={measured:i,actual:this.removeElementScroll(i)},this.layoutCorrected=h.createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.actual),null===(t=this.options.visualElement)||void 0===t||t.notifyLayoutMeasure(this.layout.actual,null==o?void 0:o.actual)}},v.prototype.updateScroll=function(){this.options.layoutScroll&&this.instance&&(this.isScrollRoot=O(this.instance),this.scroll=I(this.instance))},v.prototype.resetTransform=function(){var t;if(N){var e=this.isLayoutDirty||this.shouldResetTransform,i=this.projectionDelta&&!c.isDeltaZero(this.projectionDelta),o=null===(t=this.options.visualElement)||void 0===t?void 0:t.getProps().transformTemplate,a=null==o?void 0:o(this.latestValues,""),s=a!==this.prevTransformTemplateValue;e&&(i||y.hasTransform(this.latestValues)||s)&&(N(this.instance,a),this.shouldResetTransform=!1,this.scheduleRender())}},v.prototype.measure=function(){var t=this.options.visualElement;if(!t)return h.createBox();var e=t.measureViewportBox(),i=this.root.scroll;return i&&(r.translateAxis(e.x,i.x),r.translateAxis(e.y,i.y)),e},v.prototype.removeElementScroll=function(t){var e=h.createBox();s.copyBoxInto(e,t);for(var i=0;i<this.path.length;i++){var o=this.path[i],a=o.scroll,n=o.options,l=o.isScrollRoot;if(o!==this.root&&a&&n.layoutScroll){if(l){s.copyBoxInto(e,t);var u=this.root.scroll;u&&(r.translateAxis(e.x,-u.x),r.translateAxis(e.y,-u.y))}r.translateAxis(e.x,a.x),r.translateAxis(e.y,a.y)}}return e},v.prototype.applyTransform=function(t,e){void 0===e&&(e=!1);var i=h.createBox();s.copyBoxInto(i,t);for(var o=0;o<this.path.length;o++){var a=this.path[o];!e&&a.options.layoutScroll&&a.scroll&&a!==a.root&&r.transformBox(i,{x:-a.scroll.x,y:-a.scroll.y}),y.hasTransform(a.latestValues)&&r.transformBox(i,a.latestValues)}return y.hasTransform(this.latestValues)&&r.transformBox(i,this.latestValues),i},v.prototype.removeTransform=function(t){var e,i=h.createBox();s.copyBoxInto(i,t);for(var o=0;o<this.path.length;o++){var a=this.path[o];if(a.instance&&y.hasTransform(a.latestValues)){y.hasScale(a.latestValues)&&a.updateSnapshot();var r=h.createBox(),n=a.measure();s.copyBoxInto(r,n),l.removeBoxTransforms(i,a.latestValues,null===(e=a.snapshot)||void 0===e?void 0:e.layout,r)}}return y.hasTransform(this.latestValues)&&l.removeBoxTransforms(i,this.latestValues),i},v.prototype.setTargetDelta=function(t){this.targetDelta=t,this.root.scheduleUpdateProjection()},v.prototype.setOptions=function(e){var i;this.options=t.__assign(t.__assign(t.__assign({},this.options),e),{crossfade:null===(i=e.crossfade)||void 0===i||i})},v.prototype.clearMeasurements=function(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1},v.prototype.resolveTargetDelta=function(){var t,e=this.options,i=e.layout,o=e.layoutId;this.layout&&(i||o)&&(this.targetDelta||this.relativeTarget||(this.relativeParent=this.getClosestProjectingParent(),this.relativeParent&&this.relativeParent.layout&&(this.relativeTarget=h.createBox(),this.relativeTargetOrigin=h.createBox(),n.calcRelativePosition(this.relativeTargetOrigin,this.layout.actual,this.relativeParent.layout.actual),s.copyBoxInto(this.relativeTarget,this.relativeTargetOrigin))),(this.relativeTarget||this.targetDelta)&&(this.target||(this.target=h.createBox(),this.targetWithTransforms=h.createBox()),this.relativeTarget&&this.relativeTargetOrigin&&(null===(t=this.relativeParent)||void 0===t?void 0:t.target)?n.calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.actual):s.copyBoxInto(this.target,this.layout.actual),r.applyBoxDelta(this.target,this.targetDelta)):s.copyBoxInto(this.target,this.layout.actual),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,this.relativeParent=this.getClosestProjectingParent(),this.relativeParent&&Boolean(this.relativeParent.resumingFrom)===Boolean(this.resumingFrom)&&!this.relativeParent.options.layoutScroll&&this.relativeParent.target&&(this.relativeTarget=h.createBox(),this.relativeTargetOrigin=h.createBox(),n.calcRelativePosition(this.relativeTargetOrigin,this.target,this.relativeParent.target),s.copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)))))},v.prototype.getClosestProjectingParent=function(){if(this.parent&&!y.hasTransform(this.parent.latestValues))return(this.parent.relativeTarget||this.parent.targetDelta)&&this.parent.layout?this.parent:this.parent.getClosestProjectingParent()},v.prototype.calcProjection=function(){var t,e=this.options,i=e.layout,o=e.layoutId;if(this.isTreeAnimating=Boolean((null===(t=this.parent)||void 0===t?void 0:t.isTreeAnimating)||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),this.layout&&(i||o)){var a=this.getLead();s.copyBoxInto(this.layoutCorrected,this.layout.actual),r.applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,Boolean(this.resumingFrom)||this!==a);var l=a.target;if(l){this.projectionDelta||(this.projectionDelta=h.createDelta(),this.projectionDeltaWithTransform=h.createDelta());var u=this.treeScale.x,c=this.treeScale.y,p=this.projectionTransform;n.calcBoxDelta(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.projectionTransform=m.buildProjectionTransform(this.projectionDelta,this.treeScale),this.projectionTransform===p&&this.treeScale.x===u&&this.treeScale.y===c||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l))}}},v.prototype.hide=function(){this.isVisible=!1},v.prototype.show=function(){this.isVisible=!0},v.prototype.scheduleRender=function(t){var e,i,o;void 0===t&&(t=!0),null===(i=(e=this.options).scheduleRender)||void 0===i||i.call(e),t&&(null===(o=this.getStack())||void 0===o||o.scheduleRender()),this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)},v.prototype.setAnimationOrigin=function(e,i){var o,s=this;void 0===i&&(i=!1);var r=this.snapshot,l=(null==r?void 0:r.latestValues)||{},u=t.__assign({},this.latestValues),c=h.createDelta();this.relativeTarget=this.relativeTargetOrigin=void 0,this.attemptToResolveRelativeTarget=!i;var p=h.createBox(),d=null==r?void 0:r.isShared,m=((null===(o=this.getStack())||void 0===o?void 0:o.members.length)||0)<=1,v=Boolean(d&&!m&&!0===this.options.crossfade&&!this.path.some(C));this.animationProgress=0,this.mixTargetDelta=function(t){var i,o=t/1e3;F(c.x,e.x,o),F(c.y,e.y,o),s.setTargetDelta(c),s.relativeTarget&&s.relativeTargetOrigin&&s.layout&&(null===(i=s.relativeParent)||void 0===i?void 0:i.layout)&&(n.calcRelativePosition(p,s.layout.actual,s.relativeParent.layout.actual),_(s.relativeTarget,s.relativeTargetOrigin,p,o)),d&&(s.animationValues=u,a.mixValues(u,l,s.latestValues,o,v,m)),s.root.scheduleUpdateProjection(),s.scheduleRender(),s.animationProgress=o},this.mixTargetDelta(0)},v.prototype.startAnimation=function(o){var a,s,r=this;this.notifyListeners("animationStart"),null===(a=this.currentAnimation)||void 0===a||a.stop(),this.resumingFrom&&(null===(s=this.resumingFrom.currentAnimation)||void 0===s||s.stop()),this.pendingAnimation&&(e.cancelSync.update(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=e.default.update((function(){T.globalProjectionState.hasAnimatedSinceResize=!0,r.currentAnimation=i.animate(0,1e3,t.__assign(t.__assign({},o),{onUpdate:function(t){var e;r.mixTargetDelta(t),null===(e=o.onUpdate)||void 0===e||e.call(o,t)},onComplete:function(){var t;null===(t=o.onComplete)||void 0===t||t.call(o),r.completeAnimation()}})),r.resumingFrom&&(r.resumingFrom.currentAnimation=r.currentAnimation),r.pendingAnimation=void 0}))},v.prototype.completeAnimation=function(){var t;this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0),null===(t=this.getStack())||void 0===t||t.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")},v.prototype.finishAnimation=function(){var t;this.currentAnimation&&(null===(t=this.mixTargetDelta)||void 0===t||t.call(this,1e3),this.currentAnimation.stop()),this.completeAnimation()},v.prototype.applyTransformsToTarget=function(){var t=this.getLead(),e=t.targetWithTransforms,i=t.target,o=t.layout,a=t.latestValues;e&&i&&o&&(s.copyBoxInto(e,i),r.transformBox(e,a),n.calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,e,a))},v.prototype.registerSharedNode=function(t,e){var i,o,a;this.sharedNodes.has(t)||this.sharedNodes.set(t,new p.NodeStack),this.sharedNodes.get(t).add(e),e.promote({transition:null===(i=e.options.initialPromotionConfig)||void 0===i?void 0:i.transition,preserveFollowOpacity:null===(a=null===(o=e.options.initialPromotionConfig)||void 0===o?void 0:o.shouldPreserveFollowOpacity)||void 0===a?void 0:a.call(o,e)})},v.prototype.isLead=function(){var t=this.getStack();return!t||t.lead===this},v.prototype.getLead=function(){var t;return this.options.layoutId&&(null===(t=this.getStack())||void 0===t?void 0:t.lead)||this},v.prototype.getPrevLead=function(){var t;return this.options.layoutId?null===(t=this.getStack())||void 0===t?void 0:t.prevLead:void 0},v.prototype.getStack=function(){var t=this.options.layoutId;if(t)return this.root.sharedNodes.get(t)},v.prototype.promote=function(t){var e=void 0===t?{}:t,i=e.needsReset,o=e.transition,a=e.preserveFollowOpacity,s=this.getStack();s&&s.promote(this,a),i&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})},v.prototype.relegate=function(){var t=this.getStack();return!!t&&t.relegate(this)},v.prototype.resetRotation=function(){var t=this.options.visualElement;if(t){for(var e=!1,i={},o=0;o<f.transformAxes.length;o++){var a="rotate"+f.transformAxes[o];t.getStaticValue(a)&&(e=!0,i[a]=t.getStaticValue(a),t.setStaticValue(a,0))}if(e){for(var a in null==t||t.syncRender(),i)t.setStaticValue(a,i[a]);t.scheduleRender()}}},v.prototype.getProjectionStyles=function(t){var e,i,o,a,s,r;void 0===t&&(t={});var n={};if(!this.instance||this.isSVG)return n;if(!this.isVisible)return{visibility:"hidden"};n.visibility="";var l=null===(e=this.options.visualElement)||void 0===e?void 0:e.getProps().transformTemplate;if(this.needsReset)return this.needsReset=!1,n.opacity="",n.pointerEvents=x.resolveMotionValue(t.pointerEvents)||"",n.transform=l?l(this.latestValues,""):"none",n;var h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){var u={};return this.options.layoutId&&(u.opacity=null!==(i=this.latestValues.opacity)&&void 0!==i?i:1,u.pointerEvents=x.resolveMotionValue(t.pointerEvents)||""),this.hasProjected&&!y.hasTransform(this.latestValues)&&(u.transform=l?l({},""):"none",this.hasProjected=!1),u}var c=h.animationValues||h.latestValues;this.applyTransformsToTarget(),n.transform=m.buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,c),l&&(n.transform=l(c,n.transform));var p=this.projectionDelta,v=p.x,f=p.y;for(var g in n.transformOrigin="".concat(100*v.origin,"% ").concat(100*f.origin,"% 0"),h.animationValues?n.opacity=h===this?null!==(a=null!==(o=c.opacity)&&void 0!==o?o:this.latestValues.opacity)&&void 0!==a?a:1:this.preserveOpacity?this.latestValues.opacity:c.opacityExit:n.opacity=h===this?null!==(s=c.opacity)&&void 0!==s?s:"":null!==(r=c.opacityExit)&&void 0!==r?r:0,d.scaleCorrectors)if(void 0!==c[g]){var T=d.scaleCorrectors[g],j=T.correct,S=T.applyTo,P=j(c[g],h);if(S)for(var B=S.length,A=0;A<B;A++)n[S[A]]=P;else n[g]=P}return this.options.layoutId&&(n.pointerEvents=h===this?x.resolveMotionValue(t.pointerEvents)||"":"none"),n},v.prototype.clearSnapshot=function(){this.resumeFrom=this.snapshot=void 0},v.prototype.resetTree=function(){this.root.nodes.forEach((function(t){var e;return null===(e=t.currentAnimation)||void 0===e?void 0:e.stop()})),this.root.nodes.forEach(A),this.root.sharedNodes.clear()},v}()},exports.mixAxis=U,exports.mixAxisDelta=F,exports.mixBox=_;
//# sourceMappingURL=create-projection-node.mjs.js.map
