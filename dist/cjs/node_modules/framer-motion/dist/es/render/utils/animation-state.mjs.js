"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var i=require("../../../../../tslib/tslib.es6.js"),e=require("../../animation/utils/is-animation-controls.mjs.js"),n=require("../../animation/utils/is-keyframes-target.mjs.js"),t=require("../../utils/shallow-compare.mjs.js"),a=require("./animation.mjs.js"),r=require("./types.mjs.js"),s=require("./variants.mjs.js"),o=[r.AnimationType.Animate,r.AnimationType.InView,r.AnimationType.Focus,r.AnimationType.Hover,r.AnimationType.Tap,r.AnimationType.Drag,r.AnimationType.Exit],u=i.__spreadArray([],i.__read(o),!1).reverse(),v=o.length;function m(i,e){return"string"==typeof e?e!==i:!!s.isVariantLabels(e)&&!t.shallowCompare(e,i)}function l(i){return void 0===i&&(i=!1),{isActive:i,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}exports.checkVariantsDidChange=m,exports.createAnimationState=function(o){var p,c=function(i){return function(e){return Promise.all(e.map((function(e){var n=e.animation,t=e.options;return a.animateVisualElement(i,n,t)})))}}(o),A=((p={})[r.AnimationType.Animate]=l(!0),p[r.AnimationType.InView]=l(),p[r.AnimationType.Hover]=l(),p[r.AnimationType.Tap]=l(),p[r.AnimationType.Drag]=l(),p[r.AnimationType.Focus]=l(),p[r.AnimationType.Exit]=l(),p),d={},y=!0,f=function(e,n){var t=s.resolveVariant(o,n);if(t){t.transition;var a=t.transitionEnd,r=i.__rest(t,["transition","transitionEnd"]);e=i.__assign(i.__assign(i.__assign({},e),r),a)}return e};function _(a,r){for(var l,p=o.getProps(),_=o.getVariantContext(!0)||{},g=[],T=new Set,h={},j=1/0,V=function(v){var c=u[v],d=A[c],V=null!==(l=p[c])&&void 0!==l?l:_[c],P=s.isVariantLabel(V),b=c===r?d.isActive:null;!1===b&&(j=v);var q=V===_[c]&&V!==p[c]&&P;if(q&&y&&o.manuallyAnimateOnMount&&(q=!1),d.protectedKeys=i.__assign({},h),!d.isActive&&null===b||!V&&!d.prevProp||e.isAnimationControls(V)||"boolean"==typeof V)return"continue";var w=m(d.prevProp,V),x=w||c===r&&d.isActive&&!q&&P||v>j&&P,C=Array.isArray(V)?V:[V],E=C.reduce(f,{});!1===b&&(E={});var K=d.prevResolvedValues,O=void 0===K?{}:K,S=i.__assign(i.__assign({},O),E),k=function(i){x=!0,T.delete(i),d.needsAnimating[i]=!0};for(var D in S){var F=E[D],I=O[D];h.hasOwnProperty(D)||(F!==I?n.isKeyframesTarget(F)&&n.isKeyframesTarget(I)?!t.shallowCompare(F,I)||w?k(D):d.protectedKeys[D]=!0:void 0!==F?k(D):T.add(D):void 0!==F&&T.has(D)?k(D):d.protectedKeys[D]=!0)}d.prevProp=V,d.prevResolvedValues=E,d.isActive&&(h=i.__assign(i.__assign({},h),E)),y&&o.blockInitialAnimation&&(x=!1),x&&!q&&g.push.apply(g,i.__spreadArray([],i.__read(C.map((function(e){return{animation:e,options:i.__assign({type:c},a)}}))),!1))},P=0;P<v;P++)V(P);if(d=i.__assign({},h),T.size){var b={};T.forEach((function(i){var e=o.getBaseTarget(i);void 0!==e&&(b[i]=e)})),g.push({animation:b})}var q=Boolean(g.length);return y&&!1===p.initial&&!o.manuallyAnimateOnMount&&(q=!1),y=!1,q?c(g):Promise.resolve()}return{isAnimated:function(i){return void 0!==d[i]},animateChanges:_,setActive:function(i,e,n){var t;if(A[i].isActive===e)return Promise.resolve();null===(t=o.variantChildren)||void 0===t||t.forEach((function(n){var t;return null===(t=n.animationState)||void 0===t?void 0:t.setActive(i,e)})),A[i].isActive=e;var a=_(n,i);for(var r in A)A[r].protectedKeys={};return a},setAnimateFunction:function(i){c=i(o)},getState:function(){return A}}},exports.variantPriorityOrder=o;
//# sourceMappingURL=animation-state.mjs.js.map
