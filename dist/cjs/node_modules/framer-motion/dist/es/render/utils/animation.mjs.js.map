{"version":3,"file":"animation.mjs.js","sources":["../../../../../../../../node_modules/framer-motion/dist/es/render/utils/animation.mjs"],"sourcesContent":["import { __read, __rest, __assign } from 'tslib';\nimport { startAnimation } from '../../animation/utils/transitions.mjs';\nimport { setTarget } from './setters.mjs';\nimport { resolveVariant } from './variants.mjs';\nimport { isTransformProp } from '../html/utils/transform.mjs';\n\nfunction animateVisualElement(visualElement, definition, options) {\n    if (options === void 0) { options = {}; }\n    visualElement.notifyAnimationStart(definition);\n    var animation;\n    if (Array.isArray(definition)) {\n        var animations = definition.map(function (variant) {\n            return animateVariant(visualElement, variant, options);\n        });\n        animation = Promise.all(animations);\n    }\n    else if (typeof definition === \"string\") {\n        animation = animateVariant(visualElement, definition, options);\n    }\n    else {\n        var resolvedDefinition = typeof definition === \"function\"\n            ? resolveVariant(visualElement, definition, options.custom)\n            : definition;\n        animation = animateTarget(visualElement, resolvedDefinition, options);\n    }\n    return animation.then(function () {\n        return visualElement.notifyAnimationComplete(definition);\n    });\n}\nfunction animateVariant(visualElement, variant, options) {\n    var _a;\n    if (options === void 0) { options = {}; }\n    var resolved = resolveVariant(visualElement, variant, options.custom);\n    var _b = (resolved || {}).transition, transition = _b === void 0 ? visualElement.getDefaultTransition() || {} : _b;\n    if (options.transitionOverride) {\n        transition = options.transitionOverride;\n    }\n    /**\n     * If we have a variant, create a callback that runs it as an animation.\n     * Otherwise, we resolve a Promise immediately for a composable no-op.\n     */\n    var getAnimation = resolved\n        ? function () { return animateTarget(visualElement, resolved, options); }\n        : function () { return Promise.resolve(); };\n    /**\n     * If we have children, create a callback that runs all their animations.\n     * Otherwise, we resolve a Promise immediately for a composable no-op.\n     */\n    var getChildAnimations = ((_a = visualElement.variantChildren) === null || _a === void 0 ? void 0 : _a.size)\n        ? function (forwardDelay) {\n            if (forwardDelay === void 0) { forwardDelay = 0; }\n            var _a = transition.delayChildren, delayChildren = _a === void 0 ? 0 : _a, staggerChildren = transition.staggerChildren, staggerDirection = transition.staggerDirection;\n            return animateChildren(visualElement, variant, delayChildren + forwardDelay, staggerChildren, staggerDirection, options);\n        }\n        : function () { return Promise.resolve(); };\n    /**\n     * If the transition explicitly defines a \"when\" option, we need to resolve either\n     * this animation or all children animations before playing the other.\n     */\n    var when = transition.when;\n    if (when) {\n        var _c = __read(when === \"beforeChildren\"\n            ? [getAnimation, getChildAnimations]\n            : [getChildAnimations, getAnimation], 2), first = _c[0], last = _c[1];\n        return first().then(last);\n    }\n    else {\n        return Promise.all([getAnimation(), getChildAnimations(options.delay)]);\n    }\n}\n/**\n * @internal\n */\nfunction animateTarget(visualElement, definition, _a) {\n    var _b;\n    var _c = _a === void 0 ? {} : _a, _d = _c.delay, delay = _d === void 0 ? 0 : _d, transitionOverride = _c.transitionOverride, type = _c.type;\n    var _e = visualElement.makeTargetAnimatable(definition), _f = _e.transition, transition = _f === void 0 ? visualElement.getDefaultTransition() : _f, transitionEnd = _e.transitionEnd, target = __rest(_e, [\"transition\", \"transitionEnd\"]);\n    if (transitionOverride)\n        transition = transitionOverride;\n    var animations = [];\n    var animationTypeState = type && ((_b = visualElement.animationState) === null || _b === void 0 ? void 0 : _b.getState()[type]);\n    for (var key in target) {\n        var value = visualElement.getValue(key);\n        var valueTarget = target[key];\n        if (!value ||\n            valueTarget === undefined ||\n            (animationTypeState &&\n                shouldBlockAnimation(animationTypeState, key))) {\n            continue;\n        }\n        var valueTransition = __assign({ delay: delay }, transition);\n        /**\n         * Make animation instant if this is a transform prop and we should reduce motion.\n         */\n        if (visualElement.shouldReduceMotion && isTransformProp(key)) {\n            valueTransition = __assign(__assign({}, valueTransition), { type: false, delay: 0 });\n        }\n        var animation = startAnimation(key, value, valueTarget, valueTransition);\n        animations.push(animation);\n    }\n    return Promise.all(animations).then(function () {\n        transitionEnd && setTarget(visualElement, transitionEnd);\n    });\n}\nfunction animateChildren(visualElement, variant, delayChildren, staggerChildren, staggerDirection, options) {\n    if (delayChildren === void 0) { delayChildren = 0; }\n    if (staggerChildren === void 0) { staggerChildren = 0; }\n    if (staggerDirection === void 0) { staggerDirection = 1; }\n    var animations = [];\n    var maxStaggerDuration = (visualElement.variantChildren.size - 1) * staggerChildren;\n    var generateStaggerDuration = staggerDirection === 1\n        ? function (i) {\n            if (i === void 0) { i = 0; }\n            return i * staggerChildren;\n        }\n        : function (i) {\n            if (i === void 0) { i = 0; }\n            return maxStaggerDuration - i * staggerChildren;\n        };\n    Array.from(visualElement.variantChildren)\n        .sort(sortByTreeOrder)\n        .forEach(function (child, i) {\n        animations.push(animateVariant(child, variant, __assign(__assign({}, options), { delay: delayChildren + generateStaggerDuration(i) })).then(function () { return child.notifyAnimationComplete(variant); }));\n    });\n    return Promise.all(animations);\n}\nfunction stopAnimation(visualElement) {\n    visualElement.forEachValue(function (value) { return value.stop(); });\n}\nfunction sortByTreeOrder(a, b) {\n    return a.sortNodePosition(b);\n}\n/**\n * Decide whether we should block this animation. Previously, we achieved this\n * just by checking whether the key was listed in protectedKeys, but this\n * posed problems if an animation was triggered by afterChildren and protectedKeys\n * had been set to true in the meantime.\n */\nfunction shouldBlockAnimation(_a, key) {\n    var protectedKeys = _a.protectedKeys, needsAnimating = _a.needsAnimating;\n    var shouldBlock = protectedKeys.hasOwnProperty(key) && needsAnimating[key] !== true;\n    needsAnimating[key] = false;\n    return shouldBlock;\n}\n\nexport { animateVisualElement, sortByTreeOrder, stopAnimation };\n"],"names":["animateVariant","visualElement","variant","options","_a","resolved","resolveVariant","custom","_b","transition","getDefaultTransition","transitionOverride","getAnimation","animateTarget","Promise","resolve","getChildAnimations","variantChildren","size","forwardDelay","delayChildren","staggerChildren","staggerDirection","animations","maxStaggerDuration","generateStaggerDuration","i","Array","from","sort","sortByTreeOrder","forEach","child","push","__assign","delay","then","notifyAnimationComplete","all","animateChildren","when","_c","__read","first","last","definition","_d","type","_e","makeTargetAnimatable","_f","transitionEnd","target","__rest","animationTypeState","animationState","getState","key","value","getValue","valueTarget","undefined","shouldBlockAnimation","valueTransition","shouldReduceMotion","isTransformProp","animation","startAnimation","setTarget","a","b","sortNodePosition","protectedKeys","needsAnimating","shouldBlock","hasOwnProperty","notifyAnimationStart","isArray","map","resolvedDefinition"],"mappings":"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"}