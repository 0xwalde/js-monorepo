"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../../../tslib/tslib.es6.js"),n=require("../../../node_modules/framesync/dist/es/index.mjs.js"),t=require("../value/index.mjs.js"),r=require("../value/utils/is-motion-value.mjs.js"),i=require("./utils/animation-state.mjs.js"),a=require("./utils/lifecycles.mjs.js"),o=require("./utils/motion-values.mjs.js"),u=require("./utils/variants.mjs.js"),l=e.__spreadArray(["initial"],e.__read(i.variantPriorityOrder),!1),s=l.length;exports.visualElement=function(i){var d=i.treeType,c=void 0===d?"":d,f=i.build,v=i.getBaseTarget,m=i.makeTargetAnimatable,p=i.measureViewportBox,V=i.render,g=i.readValueFromInstance,h=i.removeValueFromRenderState,j=i.sortNodePosition,y=i.scrapeMotionValuesFromProps;return function(i,d){var b=i.parent,P=i.props,C=i.presenceId,_=i.blockInitialAnimation,I=i.visualState,M=i.shouldReduceMotion;void 0===d&&(d={});var T,R,q=!1,x=I.latestValues,S=I.renderState,A=a.createLifecycles(),B=new Map,k=new Map,w={},L=e.__assign({},x);function N(){T&&q&&(E(),V(T,S,P.style,J.projection))}function E(){f(J,S,x,d,P)}function F(){A.notifyUpdate(x)}function O(e,t){var r=t.onChange((function(t){x[e]=t,P.onUpdate&&n.default.update(F,!1,!0)})),i=t.onRenderRequest(J.scheduleRender);k.set(e,(function(){r(),i()}))}var U=y(P);for(var D in U){var z=U[D];void 0!==x[D]&&r.isMotionValue(z)&&z.set(x[D],!1)}var G=u.checkIfControllingVariants(P),H=u.checkIfVariantNode(P),J=e.__assign(e.__assign({treeType:c,current:null,depth:b?b.depth+1:0,parent:b,children:new Set,presenceId:C,shouldReduceMotion:M,variantChildren:H?new Set:void 0,isVisible:void 0,manuallyAnimateOnMount:Boolean(null==b?void 0:b.isMounted()),blockInitialAnimation:_,isMounted:function(){return Boolean(T)},mount:function(e){q=!0,T=J.current=e,J.projection&&J.projection.mount(e),H&&b&&!G&&(R=null==b?void 0:b.addVariantChild(J)),B.forEach((function(e,n){return O(n,e)})),null==b||b.children.add(J),J.setProps(P)},unmount:function(){var e;null===(e=J.projection)||void 0===e||e.unmount(),n.cancelSync.update(F),n.cancelSync.render(N),k.forEach((function(e){return e()})),null==R||R(),null==b||b.children.delete(J),A.clearAllListeners(),T=void 0,q=!1},addVariantChild:function(e){var n,t=J.getClosestVariantNode();if(t)return null===(n=t.variantChildren)||void 0===n||n.add(e),function(){return t.variantChildren.delete(e)}},sortNodePosition:function(e){return j&&c===e.treeType?j(J.getInstance(),e.getInstance()):0},getClosestVariantNode:function(){return H?J:null==b?void 0:b.getClosestVariantNode()},getLayoutId:function(){return P.layoutId},getInstance:function(){return T},getStaticValue:function(e){return x[e]},setStaticValue:function(e,n){return x[e]=n},getLatestValues:function(){return x},setVisibility:function(e){J.isVisible!==e&&(J.isVisible=e,J.scheduleRender())},makeTargetAnimatable:function(e,n){return void 0===n&&(n=!0),m(J,e,P,n)},measureViewportBox:function(){return p(T,P)},addValue:function(e,n){J.hasValue(e)&&J.removeValue(e),B.set(e,n),x[e]=n.get(),O(e,n)},removeValue:function(e){var n;B.delete(e),null===(n=k.get(e))||void 0===n||n(),k.delete(e),delete x[e],h(e,S)},hasValue:function(e){return B.has(e)},getValue:function(e,n){var r=B.get(e);return void 0===r&&void 0!==n&&(r=t.motionValue(n),J.addValue(e,r)),r},forEachValue:function(e){return B.forEach(e)},readValue:function(e){var n;return null!==(n=x[e])&&void 0!==n?n:g(T,e,d)},setBaseTarget:function(e,n){L[e]=n},getBaseTarget:function(e){if(v){var n=v(P,e);if(void 0!==n&&!r.isMotionValue(n))return n}return L[e]}},A),{build:function(){return E(),S},scheduleRender:function(){n.default.render(N,!1,!0)},syncRender:N,setProps:function(e){(e.transformTemplate||P.transformTemplate)&&J.scheduleRender(),P=e,A.updatePropListeners(e),w=o.updateMotionValuesFromProps(J,y(P),w)},getProps:function(){return P},getVariant:function(e){var n;return null===(n=P.variants)||void 0===n?void 0:n[e]},getDefaultTransition:function(){return P.transition},getTransformPagePoint:function(){return P.transformPagePoint},getVariantContext:function(e){if(void 0===e&&(e=!1),e)return null==b?void 0:b.getVariantContext();if(!G){var n=(null==b?void 0:b.getVariantContext())||{};return void 0!==P.initial&&(n.initial=P.initial),n}for(var t={},r=0;r<s;r++){var i=l[r],a=P[i];(u.isVariantLabel(a)||!1===a)&&(t[i]=a)}return t}});return J}};
//# sourceMappingURL=index.mjs.js.map
