"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../../../../tslib/tslib.es6.js");require("../../../../../react/index.js");var r=require("../../utils/process.mjs.js"),t=require("../../utils/use-force-update.mjs.js"),n=require("../../utils/use-is-mounted.mjs.js"),s=require("./PresenceChild.mjs.js"),i=require("../../context/LayoutGroupContext.mjs.js"),u=require("../../utils/use-isomorphic-effect.mjs.js"),c=require("../../utils/use-unmount-effect.mjs.js"),o=require("../../../../../../_virtual/index.js"),a=function(e){return e.key||""};exports.AnimatePresence=function(f){var l=f.children,p=f.custom,d=f.initial,m=void 0===d||d,x=f.onExitComplete,v=f.exitBeforeEnter,h=f.presenceAffectsLayout,j=void 0===h||h,E=e.__read(t.useForceUpdate(),1)[0],y=o.react.exports.useContext(i.LayoutGroupContext).forceRender;y&&(E=y);var q=n.useIsMounted(),C=function(e){var r=[];return o.react.exports.Children.forEach(e,(function(e){o.react.exports.isValidElement(e)&&r.push(e)})),r}(l),P=C,_=new Set,A=o.react.exports.useRef(P),L=o.react.exports.useRef(new Map).current,g=o.react.exports.useRef(!0);if(u.useIsomorphicLayoutEffect((function(){g.current=!1,function(e,r){e.forEach((function(e){var t=a(e);r.set(t,e)}))}(C,L),A.current=P})),c.useUnmountEffect((function(){g.current=!0,L.clear(),_.clear()})),g.current)return o.react.exports.createElement(o.react.exports.Fragment,null,P.map((function(e){return o.react.exports.createElement(s.PresenceChild,{key:a(e),isPresent:!0,initial:!!m&&void 0,presenceAffectsLayout:j},e)})));P=e.__spreadArray([],e.__read(P),!1);for(var k=A.current.map(a),b=C.map(a),w=k.length,O=0;O<w;O++){var R=k[O];-1===b.indexOf(R)&&_.add(R)}return v&&_.size&&(P=[]),_.forEach((function(e){if(-1===b.indexOf(e)){var r=L.get(e);if(r){var t=k.indexOf(e);P.splice(t,0,o.react.exports.createElement(s.PresenceChild,{key:a(r),isPresent:!1,onExitComplete:function(){L.delete(e),_.delete(e);var r=A.current.findIndex((function(r){return r.key===e}));if(A.current.splice(r,1),!_.size){if(A.current=C,!1===q.current)return;E(),x&&x()}},custom:p,presenceAffectsLayout:j},r))}}})),P=P.map((function(e){var r=e.key;return _.has(r)?e:o.react.exports.createElement(s.PresenceChild,{key:a(e),isPresent:!0,presenceAffectsLayout:j},e)})),"production"!==r.env&&v&&P.length>1&&console.warn("You're attempting to animate multiple children within AnimatePresence, but its exitBeforeEnter prop is set to true. This will lead to odd visual behaviour."),o.react.exports.createElement(o.react.exports.Fragment,null,_.size?P:P.map((function(e){return o.react.exports.cloneElement(e)})))};
//# sourceMappingURL=index.mjs.js.map
