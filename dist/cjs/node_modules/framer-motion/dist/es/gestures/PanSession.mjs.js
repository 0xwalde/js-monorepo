"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../../../tslib/tslib.es6.js"),e=require("./utils/event-type.mjs.js"),n=require("../events/event-info.mjs.js"),s=require("../../../node_modules/framesync/dist/es/index.mjs.js"),i=require("../utils/time-conversion.mjs.js"),o=require("../events/use-pointer-event.mjs.js"),r=require("../../../../popmotion/dist/es/utils/distance.mjs.js"),a=require("../../../../popmotion/dist/es/utils/pipe.mjs.js"),u=function(){function i(i,u,l){var p=this,h=(void 0===l?{}:l).transformPagePoint;if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=function(){if(p.lastMoveEvent&&p.lastMoveEventInfo){var e=d(p.lastMoveEventInfo,p.history),n=null!==p.startEvent,i=r.distance(e.offset,{x:0,y:0})>=3;if(n||i){var o=e.point,a=s.getFrameData().timestamp;p.history.push(t.__assign(t.__assign({},o),{timestamp:a}));var u=p.handlers,v=u.onStart,l=u.onMove;n||(v&&v(p.lastMoveEvent,e),p.startEvent=p.lastMoveEvent),l&&l(p.lastMoveEvent,e)}}},this.handlePointerMove=function(t,n){p.lastMoveEvent=t,p.lastMoveEventInfo=v(n,p.transformPagePoint),e.isMouseEvent(t)&&0===t.buttons?p.handlePointerUp(t,n):s.default.update(p.updatePoint,!0)},this.handlePointerUp=function(t,e){p.end();var n=p.handlers,s=n.onEnd,i=n.onSessionEnd,o=d(v(e,p.transformPagePoint),p.history);p.startEvent&&s&&s(t,o),i&&i(t,o)},!(e.isTouchEvent(i)&&i.touches.length>1)){this.handlers=u,this.transformPagePoint=h;var m=v(n.extractEventInfo(i),this.transformPagePoint),f=m.point,c=s.getFrameData().timestamp;this.history=[t.__assign(t.__assign({},f),{timestamp:c})];var y=u.onSessionStart;y&&y(i,d(m,this.history)),this.removeListeners=a.pipe(o.addPointerEvent(window,"pointermove",this.handlePointerMove),o.addPointerEvent(window,"pointerup",this.handlePointerUp),o.addPointerEvent(window,"pointercancel",this.handlePointerUp))}}return i.prototype.updateHandlers=function(t){this.handlers=t},i.prototype.end=function(){this.removeListeners&&this.removeListeners(),s.cancelSync.update(this.updatePoint)},i}();function v(t,e){return e?{point:e(t.point)}:t}function l(t,e){return{x:t.x-e.x,y:t.y-e.y}}function d(t,e){var n=t.point;return{point:n,delta:l(n,h(e)),offset:l(n,p(e)),velocity:m(e,.1)}}function p(t){return t[0]}function h(t){return t[t.length-1]}function m(t,e){if(t.length<2)return{x:0,y:0};for(var n=t.length-1,s=null,o=h(t);n>=0&&(s=t[n],!(o.timestamp-s.timestamp>i.secondsToMilliseconds(e)));)n--;if(!s)return{x:0,y:0};var r=(o.timestamp-s.timestamp)/1e3;if(0===r)return{x:0,y:0};var a={x:(o.x-s.x)/r,y:(o.y-s.y)/r};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}exports.PanSession=u;
//# sourceMappingURL=PanSession.mjs.js.map
