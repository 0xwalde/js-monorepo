{"version":3,"file":"focusMerge.js","sources":["../../../../../../node_modules/focus-lock/dist/es2015/focusMerge.js"],"sourcesContent":["import { NEW_FOCUS, newFocus } from './solver';\nimport { filterAutoFocusable, getAllTabbableNodes, getTabbableNodes } from './utils/DOMutils';\nimport { getAllAffectedNodes } from './utils/all-affected';\nimport { pickFirstFocus } from './utils/firstFocus';\nimport { getActiveElement } from './utils/getActiveElement';\nimport { getDataset, isDefined, isNotAGuard } from './utils/is';\nimport { allParentAutofocusables, getTopCommonParent } from './utils/parenting';\nvar findAutoFocused = function (autoFocusables) {\n    return function (node) { var _a; \n    // @ts-expect-error\n    return node.autofocus || !!((_a = getDataset(node)) === null || _a === void 0 ? void 0 : _a.autofocus) || autoFocusables.indexOf(node) >= 0; };\n};\nvar reorderNodes = function (srcNodes, dstNodes) {\n    var remap = new Map();\n    // no Set(dstNodes) for IE11 :(\n    dstNodes.forEach(function (entity) { return remap.set(entity.node, entity); });\n    // remap to dstNodes\n    return srcNodes.map(function (node) { return remap.get(node); }).filter(isDefined);\n};\n/**\n * given top node(s) and the last active element return the element to be focused next\n * @param topNode\n * @param lastNode\n */\nexport var getFocusMerge = function (topNode, lastNode) {\n    var activeElement = document && getActiveElement();\n    var entries = getAllAffectedNodes(topNode).filter(isNotAGuard);\n    var commonParent = getTopCommonParent(activeElement || topNode, topNode, entries);\n    var visibilityCache = new Map();\n    var anyFocusable = getAllTabbableNodes(entries, visibilityCache);\n    var innerElements = getTabbableNodes(entries, visibilityCache).filter(function (_a) {\n        var node = _a.node;\n        return isNotAGuard(node);\n    });\n    if (!innerElements[0]) {\n        innerElements = anyFocusable;\n        if (!innerElements[0]) {\n            return undefined;\n        }\n    }\n    var outerNodes = getAllTabbableNodes([commonParent], visibilityCache).map(function (_a) {\n        var node = _a.node;\n        return node;\n    });\n    var orderedInnerElements = reorderNodes(outerNodes, innerElements);\n    var innerNodes = orderedInnerElements.map(function (_a) {\n        var node = _a.node;\n        return node;\n    });\n    var newId = newFocus(innerNodes, outerNodes, activeElement, lastNode);\n    if (newId === NEW_FOCUS) {\n        var autoFocusable = filterAutoFocusable(anyFocusable.map(function (_a) {\n            var node = _a.node;\n            return node;\n        })).filter(findAutoFocused(allParentAutofocusables(entries, visibilityCache)));\n        return {\n            node: autoFocusable && autoFocusable.length\n                ? pickFirstFocus(autoFocusable)\n                : pickFirstFocus(filterAutoFocusable(innerNodes)),\n        };\n    }\n    if (newId === undefined) {\n        return newId;\n    }\n    return orderedInnerElements[newId];\n};\n"],"names":["topNode","lastNode","activeElement","document","getActiveElement","entries","getAllAffectedNodes","filter","isNotAGuard","commonParent","getTopCommonParent","visibilityCache","Map","anyFocusable","getAllTabbableNodes","innerElements","getTabbableNodes","_a","node","srcNodes","dstNodes","remap","autoFocusables","outerNodes","map","orderedInnerElements","forEach","entity","set","get","isDefined","innerNodes","newId","newFocus","NEW_FOCUS","autoFocusable","filterAutoFocusable","allParentAutofocusables","autofocus","getDataset","indexOf","length","pickFirstFocus","undefined"],"mappings":"sUAwB2B,SAAUA,EAASC,GAC1C,IAAIC,EAAgBC,UAAYC,EAAAA,mBAC5BC,EAAUC,EAAAA,oBAAoBN,GAASO,OAAOC,EAAWA,aACzDC,EAAeC,EAAAA,mBAAmBR,GAAiBF,EAASA,EAASK,GACrEM,EAAkB,IAAIC,IACtBC,EAAeC,EAAAA,oBAAoBT,EAASM,GAC5CI,EAAgBC,EAAAA,iBAAiBX,EAASM,GAAiBJ,QAAO,SAAUU,GAC5E,IAAIC,EAAOD,EAAGC,KACd,OAAOV,EAAAA,YAAYU,EAC3B,IACI,GAAKH,EAAc,KACfA,EAAgBF,GACG,GAFvB,CAMA,IA5ByBM,EAAUC,EAC/BC,EANwBC,EAiCxBC,EAAaT,EAAmBA,oBAAC,CAACL,GAAeE,GAAiBa,KAAI,SAAUP,GAEhF,OADWA,EAAGC,IAEtB,IACQO,GAhCqBN,EAgCeI,EAhCLH,EAgCiBL,EA/BhDM,EAAQ,IAAIT,IAEhBQ,EAASM,SAAQ,SAAUC,GAAU,OAAON,EAAMO,IAAID,EAAOT,KAAMS,EAAU,IAEtER,EAASK,KAAI,SAAUN,GAAQ,OAAOG,EAAMQ,IAAIX,EAAQ,IAAEX,OAAOuB,EAASA,YA4B7EC,EAAaN,EAAqBD,KAAI,SAAUP,GAEhD,OADWA,EAAGC,IAEtB,IACQc,EAAQC,EAAAA,SAASF,EAAYR,EAAYrB,EAAeD,GAC5D,GAAI+B,IAAUE,EAAAA,UAAW,CACrB,IAAIC,EAAgBC,EAAmBA,oBAACvB,EAAaW,KAAI,SAAUP,GAE/D,OADWA,EAAGC,IAE1B,KAAYX,QA/CoBe,EA+CGe,EAAuBA,wBAAChC,EAASM,GA9CzD,SAAUO,GAAQ,IAAID,EAE7B,OAAOC,EAAKoB,cAA4C,QAA3BrB,EAAKsB,EAAAA,WAAWrB,UAA0B,IAAPD,OAAgB,EAASA,EAAGqB,YAAchB,EAAekB,QAAQtB,IAAS,KA6CtI,MAAO,CACHA,KAAMiB,GAAiBA,EAAcM,OAC/BC,EAAAA,eAAeP,GACfO,iBAAeN,EAAAA,oBAAoBL,IAEhD,CACD,YAAcY,IAAVX,EACOA,EAEJP,EAAqBO,EAzB3B,CA0BL"}